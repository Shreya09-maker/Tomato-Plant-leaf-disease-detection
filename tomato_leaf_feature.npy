# generate_feature_from_dataset.py

from PIL import Image
import numpy as np
from tensorflow.keras.applications import MobileNetV2
from tensorflow.keras.applications.mobilenet_v2 import preprocess_input
from tensorflow.keras.preprocessing.image import img_to_array
import os

# Set your dataset path
DATASET_FOLDER = r"C:\Users\shrey\OneDrive\Desktop\PlantVillage"


# Collect image paths
list_of_images = []
for root, dirs, files in os.walk(DATASET_FOLDER):
    for file in files:
        if file.lower().endswith(('.jpg', '.jpeg', '.png')):
            list_of_images.append(os.path.join(root, file))

if len(list_of_images) == 0:
    raise ValueError(f"No images found in {DATASET_FOLDER}")

# Load MobileNetV2 without top layer
leaf_detector = MobileNetV2(weights='imagenet', include_top=False, pooling='avg')

features_list = []
for path in list_of_images:
    img = Image.open(path).convert('RGB').resize((224, 224))
    x = img_to_array(img)
    x = np.expand_dims(x, axis=0)
    x = preprocess_input(x)
    features_list.append(leaf_detector.predict(x)[0])  # Extract features

# Average the features
tomato_leaf_feature = np.mean(features_list, axis=0)

# Save to file (no pickle)
np.save("tomato_leaf_feature.npy", tomato_leaf_feature)
print("âœ… tomato_leaf_feature.npy created successfully")



